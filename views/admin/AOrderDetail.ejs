<h1 class="box-content-detail--header">Order Details</h1>

<div class="box-content-detail-order">
    <div class="order-info">
        <p><strong>Order ID:</strong> <%= order._id %></p>
        <p><strong>Order Date:</strong> <%= new Date(order.orderDate).toLocaleString() %></p>
        <p><strong>Customer:</strong> <%= order.account.first_name %> <%= order.account.last_name %></p>
        <p><strong>Email:</strong> <%= order.account.email %></p>
        <p><strong>Status:</strong> <%= order.status %></p>
        <p><strong>Shipping Address:</strong></p>
        <p>
            <%= order.address.first_name %> <%= order.address.last_name %><br>
            <%= order.address.address %><br>
            <% if (order.address.apartment) { %>Apt: <%= order.address.apartment %><br><% } %>
            <% if (order.address.company) { %>Company: <%= order.address.company %><br><% } %>
            Phone: <%= order.address.phone %>
        </p>
    </div>

    <div class="order-products">
        <h2>Products</h2>
        <ul>
            <% order.products.forEach(item => { %>
                <li>
                    <img src="/assets/images/<%= item.product.image %>" width="50" height="50" alt="<%= item.product.name %>">
                    <div>
                        <p><strong><%= item.product.name %></strong></p>
                        <p>Serving Option: <%= item.servingOption %></p>
                        <p>Quantity: <%= item.quantity %></p>
                        <p>Price: $<%= item.product.price %></p>
                        <p>Subtotal: $<%= (item.product.price * item.quantity).toFixed(2) %></p>
                    </div>
                </li>
            <% }); %>
        </ul>
        <p><strong>Total Price: $<%= order.totalPrice %></strong></p>
    </div>

    <div class="order-actions">
        <select id="orderStatus">
            <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Pending</option>
            <option value="processing" <%= order.status === 'processing' ? 'selected' : '' %>>Processing</option>
            <option value="completed" <%= order.status === 'completed' ? 'selected' : '' %>>Completed</option>
            <option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
        </select>
        <button id="updateStatus">Update Status</button>
    </div>
</div>

<div id="message"></div>

<script>
$(document).ready(function() {
    $('#updateStatus').click(function() {
        const newStatus = $('#orderStatus').val();
        const orderId = '<%= order._id %>';

        $.ajax({
            url: `/admin/orders/update-status/${orderId}`,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ status: newStatus }),
            success: function(response) {
                $('#message').html(`<p class="success-message">${response.message}</p>`);
            },
            error: function(error) {
                $('#message').html(`<p class="error-message">${error.responseJSON.error}</p>`);
            }
        });
    });
});
</script>